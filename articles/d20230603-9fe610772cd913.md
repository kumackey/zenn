---
title: "Docker Composeã§ç«‹ã¡ä¸Šã’ãŸPostgreSQLã«ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰go runã§ç¹‹ããŸã„æœ€å°æ§‹æˆ"
emoji: "ğŸ³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ "Docker", "DockerCompose", "PostgreSQL", "Go" ]
published: true
---

# ã‚„ã‚ŠãŸã‹ã£ãŸã“ã¨

- Goã§PostgreSQLã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ãŸã„
- PostgreSQLã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ç®¡ç†ã—ãŸããªã‹ã£ãŸã®ã§ã€Docker Composeã‚’ä½¿ã„ãŸã„
- Goã‚‚DockeråŒ–ã™ã‚‹ã¨å†ãƒ“ãƒ«ãƒ‰ãŒé¢å€’ãªã®ã§ã€Goã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã—ãŸã„

# ã‚„ã£ãŸã“ã¨

```yml:docker-compose.yml
version: "3"
services:
  postgres:
    image: postgres
    restart: always
    environment:
      POSTGRES_PASSWORD: mysecretpassword
    ports:
      - "5432:5432"
```

```go:main.go
package main

import (
	"database/sql"
	"os"

	_ "github.com/lib/pq"
)

func main() {
	sqldb, err := sql.Open("postgres", os.Getenv("DATABASE_URL"))
	if err != nil {
		println(err)
	}
	defer sqldb.Close()

	// ç–é€šç¢ºèª
	if err := sqldb.Ping(); err != nil {
		println(err)
	}

	println("OK")
}
```

```bash
# 1.postgresã‚³ãƒ³ãƒ†ãƒŠã‚’ç«‹ã¡ä¸Šã’ã‚‹
docker-compose up -d postgres

# 2.go runã§å®Ÿè¡Œ
DATABASE_URL="postgres://postgres:mysecretpassword@localhost:5432/postgres?sslmode=disable" go run main.go
OK 
```

# ã“ã®ã‚„ã‚Šæ–¹ã®ãƒ¡ãƒªãƒƒãƒˆ

Goã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ãŒã‚ã£ãŸã¨ãã‚‚ã€go runã®å†å®Ÿè¡Œã ã‘ã§æ¸ˆã‚€ã®ã§æ—©ã„ã€‚
Goã‚‚DockeråŒ–ã—ãŸå ´åˆã¯ã€Dockerã®å†ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ãªã®ã§ã€ã¡ã‚‡ã£ã¨é…ã„ã€‚

ã¾ã‚æ¥­å‹™ã‚„ãƒãƒ¼ãƒ ã§é–‹ç™ºã™ã‚‹ã¨ãã«ã¯Goã‚’DockeråŒ–ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆã®æ–¹ãŒä¸Šå›ã‚‹ã¨æ€ã„ã¾ã™ã€‚
é€†ã«ã€Goã‚’DockeråŒ–ã—ã¦ã‚‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«orãƒ“ãƒ«ãƒ‰ãŒã™ãå‡ºæ¥ã‚‹ã‚„ã‚Šæ–¹ãŒã‚ã‚Œã°ãœã²çŸ¥ã‚ŠãŸã„ã®ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆé ‚ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ï¼
