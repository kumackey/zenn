---
title: "Faraday.deleteã§query stringã§ãªãrequest bodyã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™æ–¹æ³•"
emoji: "ğŸ—‘ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Ruby", "Faraday"]
published: true
---

# çµè«–

ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã°ã€request bodyã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã›ã‚‹ã€‚

```ruby
Faraday.delete('http://localhost:8000', { name: 'Alice' }) do |req|
  req.body = { name: 'Alice' }.to_json
end
```

# Faradayã¨ã¯

ã“ã‚Œã€‚
https://github.com/lostisland/faraday

# èª¿æŸ»

byebugã‚’ä½¿ã£ã¦ã©ã†ã„ã†requestãŒæ§‹ç¯‰ã•ã‚Œã‚‹ã®ã‹ã‚’è¦‹ãªãŒã‚‰èª¿æŸ»ã—ã¦ã„ã£ãŸã€‚
POSTã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ã†ã‚‰ã—ã„ã€‚

```ruby
Faraday.post('http://localhost:8000', { name: 'Alice' }.to_json)
# (byebug) request
# #<struct Faraday::Request http_method=:post, path="http://localhost:8000", params={}, headers={"User-Agent"=>"Faraday v2.7.10"}, body="{\"name\":\"Alice\"}", options=#<Faraday::RequestOptions (empty)>>
```

DELETEã‚‚åŒæ§˜ã«æ¸¡ã›ã°è‰¯ã„ã®ã‹ã¨æ€ã„ãã‚„ã€`NoMethodError`ã«ãªã‚‹ã€‚

```ruby
Faraday.delete('http://localhost:8000', { name: 'Alice' }.to_json)
# ..../lib/faraday/utils/params_hash.rb:28:in `update': undefined method `each' for "{\\"name\\":\\"Alice\\"}":String (NoMethodError)
```

èª¿ã¹ã¦ã¿ã‚‹ã¨Faraday.deleteã®ç¬¬äºŒå¼•æ•°ã¯hashãŒæ¸¡ã•ã‚Œã‚‹æƒ³å®šã£ã½ã‹ã£ãŸã€‚
https://www.rubydoc.info/github/lostisland/faraday/Faraday%2FConnection.delete

ä»¥ä¸‹ã®ã‚ˆã†ã«hashã‚’æ¸¡ã™ã¨ã‚¨ãƒ©ãƒ¼ã¯ãªããªã£ãŸãŒã€request bodyã§ãªãquery stringã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¸¡ã•ã‚Œã¦ã—ã¾ã£ãŸã€‚
ä»Šå›ç›´é¢ã—ãŸã‚±ãƒ¼ã‚¹ã§ã¯ã€ã‚µãƒ¼ãƒå´ãŒquery stringã§ãªãrequest bodyã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘ä»˜ã‘ã‚‹ã‚ˆã†å®Ÿè£…ã«ãªã£ã¦ã„ãŸã®ã§ã€ã“ã‚Œã§ã¯ä½¿ãˆãªã‹ã£ãŸã€‚

```ruby
Faraday.delete('http://localhost:8000', { name: 'Alice' })
# (byebug) request
# #<struct Faraday::Request http_method=:delete, path="http://localhost:8000", params={"name"=>"Alice"}, headers={"User-Agent"=>"Faraday v2.7.10"}, body=nil, options=#<Faraday::RequestOptions (empty)>>
# (byebug) exclusive_url
# #<URI::HTTP http://localhost:8000?name=Alice>
```

ä»¥ä¸‹ã®issueã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ãŸã‚‰ç„¡äº‹request bodyã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒå‡ºæ¥ãŸã€‚
https://github.com/lostisland/faraday/issues/693
https://lostisland.github.io/faraday/#/getting-started/quick-start?id=detailed-http-requests

```ruby
Faraday.delete('http://localhost:8000') do |req|
  req.body = { name: 'Alice' }.to_json
end
# (byebug) request
# #<struct Faraday::Request http_method=:delete, path="http://localhost:8000", params={}, headers={"User-Agent"=>"Faraday v2.7.10"}, body="{\"name\":\"Alice\"}", options=#<Faraday::RequestOptions (empty)>>
```

# è£œè¶³

HTTPã®DELETEãƒ¡ã‚½ãƒƒãƒ‰ã¯ãã‚‚ãã‚‚request bodyã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ã‚’ã—ã¦è‰¯ã„ã®ï¼Ÿã¨ã„ã†è©±ã¯ã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚
èª¿æŸ»ã—ãŸã¨ã“ã‚ã€ã€Œæ™®é€šã¯query stringã€‚ã‚µãƒ¼ãƒå´ã®å®Ÿè£…ãŒrequest bodyã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘ä»˜ã‘ã¦ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã‹ã‚‰ã€æ¨å¥¨ã¯ã—ãªã„ã€‚ã§ã‚‚RFCçš„ã«ã¯request bodyã«ã‚ˆã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ã‚’ç¦æ­¢ã‚‚ã—ã¦ãªã„ã€ã£ã¦æ„Ÿã˜ã§ã—ãŸã€‚
https://stackoverflow.com/questions/299628/is-an-entity-body-allowed-for-an-http-delete-request