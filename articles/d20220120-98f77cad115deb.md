---
title: "ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ©ã‚°ã«ã‚ˆã£ã¦ãƒ—ãƒ«ãƒªã‚¯ã‚’å°ã•ãã™ã‚‹"
emoji: "ğŸ³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ"]
published: false
---

# å…ˆã«ã¾ã¨ã‚


# è§£èª¬ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã“ã¨

## ã€Œå¤‰æ›´ã€ã‚’ã€Œè¿½åŠ ã€ã¨ã€Œå‰Šé™¤ã€ã«åˆ†ã‘ã‚‹

ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¨ä»•æ§˜å¤‰æ›´ã¯ãƒ—ãƒ«ãƒªã‚¯ã¨ã—ã¦ã¯åˆ†ã‘ãŸæ–¹ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ã‚¹ãƒˆãŒä¸‹ãŒã‚‹ã€ã¨ã„ã†ã®ã¯æœ‰åãªè©±ã§ã™ã—ã€å®Ÿéš›ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã—ãŸã“ã¨ãŒã‚ã‚‹æ–¹ã€…ãªã‚‰å®Ÿæ„Ÿã§ãã‚‹ã§ã—ã‚‡ã†ã€‚
å‚è€ƒ: [ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã‚‚ã‚‰ã„ã‚„ã™ã„ç´°ã‹ã„ãƒ—ãƒ«ãƒªã‚¯ã®åˆ‡ã‚Šåˆ†ã‘æ–¹ - Software engineering from east direction](https://khigashigashi.hatenablog.com/entry/2018/03/09/020359)

åŠ ãˆã¦ã€**ã€Œå¤‰æ›´ã€ã‚’ã€Œè¿½åŠ ã€ã¨ã€Œå‰Šé™¤ã€ã«åˆ†ã‘ãŸæ–¹ãŒè‰¯ã„**ã€ã¨ã„ã†è©±ã‚’ã—ã¾ã™ã€‚
è¿½åŠ ãƒ»å‰Šé™¤ãƒ»å¤‰æ›´ã®ãƒ—ãƒ«ãƒªã‚¯ã‚’è¦‹ãŸã¨ãã«ã€ãƒ¬ãƒ“ãƒ¥ã‚¢ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªè¦³ç‚¹ã§ãã‚Œãã‚Œãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

- è¿½åŠ : ãƒ—ãƒ«ãƒªã‚¯ã§ã¯è¿½åŠ è¡ŒãŒä¸­èº«ã¨ãªã‚Šã€ãã®è¿½åŠ ã™ã‚‹ç®‡æ‰€ãŒä»•æ§˜ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã§ãã¦ã„ã‚‹ã‹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã€‚è¨­è¨ˆãŒæ­£ã—ã„ã‚‚ã®ã‹ã®è¦³ç‚¹ã§ã‚‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã€‚
- å‰Šé™¤: ãƒ—ãƒ«ãƒªã‚¯ã§ã¯å‰Šé™¤è¡ŒãŒä¸­èº«ã¨ãªã‚Šã€å‰Šé™¤ã™ã‚‹ç®‡æ‰€ãŒä¸è¦ã¨ãªã£ã¦ã„ã‚‹ã‹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã€‚å‰Šé™¤æ¼ã‚Œãªã©ãŒãªã„ã‹ã‚‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã€‚
- å¤‰æ›´: ãƒ—ãƒ«ãƒªã‚¯ã§ã¯è¿½åŠ è¡Œã¨å‰Šé™¤è¡ŒãŒæ··åœ¨ã—ã€æ—§å®Ÿè£…ã§å®Ÿç¾ã§ãã¦ã„ãŸã“ã¨ãŒæ–°å®Ÿè£…ã§å®Ÿç¾ã§ãã¦ã„ã‚‹ã‹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã€‚æœ¬å½“ã¯è¨­è¨ˆã‚„å‰Šé™¤æ¼ã‚Œã‚‚ç´°ã‹ãè¦‹ãŸæ–¹ãŒè‰¯ã„ãŒã€ã‚ã¾ã‚Šãã“ã¾ã§é ­ãŒå›ã‚‰ãªã„ã€‚

è€ƒãˆã¦ã¿ã‚Œã°ã€å¤‰æ›´ã¯è¿½åŠ ã¨å‰Šé™¤ã‚’åˆã‚ã›ãŸã‚‚ã®ãªã®ã§ã€è¿½åŠ å˜ä½“ãƒ»å‰Šé™¤å˜ä½“ã®ãƒ—ãƒ«ãƒªã‚¯ã¨æ¯”è¼ƒã—ãŸã‚‰ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ã‚¹ãƒˆã¯é£›èºçš„ã«ä¸Šæ˜‡ã—ã¦ã—ã¾ã„ã¾ã™ã€‚
ã¤ã¾ã‚Šã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ã‚¹ãƒˆã¯ **å¤‰æ›´ > è¿½åŠ  â‰’ å‰Šé™¤** ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
å¯èƒ½ã§ã‚ã‚Œã°ã€å¤‰æ›´ã¯è¿½åŠ ã¨å‰Šé™¤ã«åˆ†ã‘ã¾ã—ã‚‡ã†ã€‚

## ã€Œå¤‰æ›´ã€ã¨ã€Œãƒªãƒªãƒ¼ã‚¹ã€ã‚’åˆ†ã‘ã‚‹

ã¾ãŸã€ã€Œå¤‰æ›´ã€ã¨ã€Œãƒªãƒªãƒ¼ã‚¹ã€ã‚‚åˆ†ã‘ãŸæ–¹ãŒè‰¯ã„ã€ã¨ã„ã†è©±ã‚’ã—ã¾ã™ã€‚
ãƒãƒ¼ã‚¸ã™ã‚‹ã¨ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã—ã¾ã†æ©Ÿèƒ½ã ã¨ã„ã†ã®ã¯ã€ãã‚Œã ã‘ã§æ‡¸å¿µç‚¹ãŒå¢—ãˆã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ã‚¹ãƒˆãŒä¸ŠãŒã‚Šã¾ã™ã€‚
ã€ŒåŸºæœ¬çš„ã«ã¯LGTMã§ã™ãŒã€ã“ã®æ©Ÿèƒ½ã¯XXæœˆXXæ—¥ã«ãƒªãƒªãƒ¼ã‚¹äºˆå®šã§ã™ã‚ˆã­ï¼Ÿãªã®ã§ä»Šãƒãƒ¼ã‚¸ã™ã‚‹ã¨ã¾ãšã„æ°—ãŒã—ã¦ã¾ã™ã€‚ ãã†ã„ãˆã°ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚è¡Œã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ã§ã™ã­ã€‚ã‚ã¨äº’æ›æ€§ãŒãƒ»ãƒ»ãƒ»ã€ã¿ãŸã„ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’æ‰“ã¤ã“ã¨ã«æ³¨æ„åŠ›ãŒæŒã£ã¦ã‹ã‚Œã¾ã™ã€‚

- å¤‰æ›´: æœ¬å½“ã¯è¨­è¨ˆã¨ã—ã¦æ­£ã—ã„ã‹ãƒ»ä»•æ§˜ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ã‚’ä¸­èº«ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸã„
- ãƒªãƒªãƒ¼ã‚¹: ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»äº’æ›æ€§ãªã©ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è¦³ç‚¹ã¨ãªã‚‹

ãƒ¬ãƒ“ãƒ¥ã‚¢ã‚’è¨­è¨ˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«é›†ä¸­ã•ã›ã‚‹ãŸã‚ã«ã‚‚ã€ ã“ã®2ã¤ã‚‚å¯èƒ½ã§ã‚ã‚Œã°åˆ†ã‘ãŸæ–¹ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚
æœ¬è¨˜äº‹ã§ã¯ **å¤‰æ›´ = è¿½åŠ  + ãƒªãƒªãƒ¼ã‚¹ + å‰Šé™¤** ã§ã‚ã‚‹ã¨ã—ã€å¤‰æ›´ã®ãƒ—ãƒ«ãƒªã‚¯ã‚’åˆ†å‰²ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

# å®Ÿè£…

å®Ÿè£…ã®èª¬æ˜ã§ã¯Goã‚’ä½¿ã£ã¦ã¾ã™ãŒã€ã‚ã‚“ã¾ã‚Šè¨€èªã¯é–¢ä¿‚ãªã„ã§ã™ã€‚

## å®Ÿè£…ä¾‹ã®å‰æ

ç§ãŸã¡ãŒæ‰€å±ã™ã‚‹Aç¤¾ã®é‹å–¶ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã«ã¯ã€å®ãã˜ã‚’ç”³ã—è¾¼ã‚€æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
å®ãã˜ã®ç”³ã—è¾¼ã¿ã‚’å—ã‘ã€ãã®ç”³ã—è¾¼ã¿æƒ…å ±ã‚„ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã«ã‚ˆã£ã¦ã€é‹ç”¨ã«ã‚ˆã‚Šå®Ÿéš›ã«å®ãã˜ã‚’å‡ºã—ã¦ã„ã¾ã—ãŸã€‚
ã“ã®é‹ç”¨æ¥­å‹™ã‚’å¤–éƒ¨å§”è¨—ã™ã‚‹ã“ã¨ã«ãªã‚Šã€å¤–éƒ¨å§”è¨—å…ˆã‚’Hogeç¤¾ã¨ã—ã¾ã™ã€‚
Hogeç¤¾ã«ã¯WEB APIã«ã‚ˆã£ã¦é€£æºã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚

- æ—§ä»•æ§˜: ç”³ã—è¾¼ã¿æƒ…å ±ã‚’ä¿æŒã—ã¦ãŠãã€ãã®æƒ…å ±ã‚’å…ƒã«é€šçŸ¥ã‚’ä½œæˆã™ã‚‹ã€‚
- æ–°ä»•æ§˜: ç”³ã—è¾¼ã¿æƒ…å ±ã‚’å…ƒã«Hogeç¤¾ã«APIã‚’å‡ºã—ã€ãã®æƒ…å ±ã‚’ä¿æŒã—ã¦ãŠãã ã‘ã§OKã€‚ é€šçŸ¥ã¯Hogeç¤¾ã‹ã‚‰å‡ºã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€å…¥ã‚Œãªã„ã“ã¨ã«ã—ãŸã€‚

ç°¡å˜ã«ã¾ã¨ã‚ã‚‹ã¨ã€æ—¢ã«å‹•ã„ã¦ã„ã‚‹æ©Ÿèƒ½ã®ä»•æ§˜ã‚’å¤‰ãˆã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã£ã¦ã“ã¨ã§ã™ã€‚

## å¤‰æ›´ã‚’ãã®ã¾ã¾ãƒ—ãƒ«ãƒªã‚¯ã«ã—ãŸå ´åˆ

æ—§ä»•æ§˜ã®å®Ÿè£…ã¯ä»¥ä¸‹ã§ã™ã€‚

```go
package usecase

import (
	"errors"
	"example.com/go-mod-test/flag/pkg"
)

type RegisterLotteryOrderUsecase struct {
	lotteryOrderRepo *pkg.LotteryOrderRepository
	notificationRepo *pkg.NotificationRepository
}

func (u *RegisterLotteryOrderUsecase) exec(uid string) (lotteryOrderID string, err error) {
	id, err := pkg.GenerateID()
	if err != nil {
		return "", err
	}

	// å®ãã˜ã®æ³¨æ–‡ã‚’ä½œæˆ
	lotteryOrder, err := pkg.NewLotteryOrder(id, uid, "", "")
	if err != nil {
		return "", errors.New("failed to create new lottery order")
	}

	// ãã®æ³¨æ–‡ã‚’æ°¸ç¶šåŒ–
	err = u.lotteryOrderRepo.Save(lotteryOrder)
	if err != nil {
		return "", errors.New("failed to save lottery order")
	}

	// å®ãã˜ã®æ³¨æ–‡ã®é€šçŸ¥ã‚’ä½œæˆ
	notif, err := pkg.NewNotificationOfRegisteringLotteryOrder(lotteryOrder)
	if err != nil {
		return "", errors.New("failed to create notification")
	}

	// ãã®é€šçŸ¥ã‚’æ°¸ç¶šåŒ–ã€‚é€šçŸ¥ã‚‚é£›ã°ã—ã¦ãã‚Œã‚‹ã¨ã™ã‚‹
	err = u.notificationRepo.Save(notif)
	if err != nil {
		return "", errors.New("failed to save notification")
	}

	return lotteryOrder.LotteryOrderID, nil
}
```

æ–°ä»•æ§˜ã®å®Ÿè£…ã¯ä»¥ä¸‹ã§ã™ã€‚

```go
package usecase

import (
	"errors"
	"example.com/go-mod-test/flag/pkg"
)

type HogeClient struct{}

func (c *HogeClient) postLotteries(_ string) (string, error) {
	// emailã‚’ä½¿ã£ã¦ã€Hogeç¤¾ã®å®ãã˜ã®æ³¨æ–‡ã™ã‚‹APIã‚’å©ã„ã¦ã€Hogeç¤¾ç®¡ç†ã®å®ãã˜IDãŒè¿”ã£ã¦ãã‚‹ã¨ã—ã¾ã—ã‚‡ã†
	return "12345", nil
}

type RegisterLotteryOrderUsecase struct {
	hoge             *HogeClient
	userRepo         *pkg.UserRepository
	lotteryOrderRepo *pkg.LotteryOrderRepository
}

func (u *RegisterLotteryOrderUsecase) exec(uid string) (lotteryOrderID string, err error) {
	id, err := pkg.GenerateID()
	if err != nil {
		return "", err
	}

	// Emailã‚’å‡ºã™ãŸã‚ã«è©²å½“ãƒ¦ãƒ¼ã‚¶ã‚’æŠ½å‡º
	user := u.userRepo.FindByUID(uid)

	// Hogeç¤¾ã«APIã§é€£æºã€‚ã“ã®ã¨ãã«é€šçŸ¥ã‚‚é£›ã¶
	hogeLotteryOrderID, err := u.hoge.postLotteries(user.Email)

	// å†…éƒ¨ã§ç®¡ç†ã™ã‚‹ãŸã‚ã€å®ãã˜ã®æ³¨æ–‡ã‚’ä½œæˆ
	lotteryOrder, err := pkg.NewLotteryOrder(id, uid, "hoge", hogeLotteryOrderID)
	if err != nil {
		return "", errors.New("failed to create new lottery order")
	}

	// ãã®æ³¨æ–‡ã‚’æ°¸ç¶šåŒ–
	err = u.lotteryOrderRepo.Save(lotteryOrder)
	if err != nil {
		return "", errors.New("failed to save lottery order")
	}

	return lotteryOrder.LotteryOrderID, nil
}
```

æ—§å®Ÿè£…ã¨æ–°å®Ÿè£…ã®diffã‚’å–ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```diff go
 package usecase
 
 import (
        "errors"
        "example.com/go-mod-test/flag/pkg"
 )
 
+type HogeClient struct{}
+
+func (c *HogeClient) postLotteries(_ string) (string, error) {
+       // emailã‚’ä½¿ã£ã¦ã€Hogeç¤¾ã®å®ãã˜ã®æ³¨æ–‡ã™ã‚‹APIã‚’å©ã„ã¦ã€Hogeç¤¾ç®¡ç†ã®å®ãã˜IDãŒè¿”ã£ã¦ãã‚‹ã¨ã—ã¾ã—ã‚‡ã†
+       return "12345", nil
+}
+
 type RegisterLotteryOrderUsecase struct {
+       hoge             *HogeClient
+       userRepo         *pkg.UserRepository
        lotteryOrderRepo *pkg.LotteryOrderRepository
-       notificationRepo *pkg.NotificationRepository
 }
 
 func (u *RegisterLotteryOrderUsecase) exec(uid string) (lotteryOrderID string, err error) {
        id, err := pkg.GenerateID()
        if err != nil {
                return "", err
        }
 
-       // å®ãã˜ã®æ³¨æ–‡ã‚’ä½œæˆ
-       lotteryOrder, err := pkg.NewLotteryOrder(id, uid, "", "")
+       // Emailã‚’å‡ºã™ãŸã‚ã«è©²å½“ãƒ¦ãƒ¼ã‚¶ã‚’æŠ½å‡º
+       user := u.userRepo.FindByUID(uid)
+
+       // Hogeç¤¾ã«APIã§é€£æºã€‚ã“ã®ã¨ãã«é€šçŸ¥ã‚‚é£›ã¶
+       hogeLotteryOrderID, err := u.hoge.postLotteries(user.Email)
+
+       // å†…éƒ¨ã§ç®¡ç†ã™ã‚‹ãŸã‚ã€å®ãã˜ã®æ³¨æ–‡ã‚’ä½œæˆ
+       lotteryOrder, err := pkg.NewLotteryOrder(id, uid, "hoge", hogeLotteryOrderID)
        if err != nil {
                return "", errors.New("failed to create new lottery order")
        }
 
        // ãã®æ³¨æ–‡ã‚’æ°¸ç¶šåŒ–
        err = u.lotteryOrderRepo.Save(lotteryOrder)
        if err != nil {
                return "", errors.New("failed to save lottery order")
        }
 
-       // å®ãã˜ã®æ³¨æ–‡ã®é€šçŸ¥ã‚’ä½œæˆ
-       notif, err := pkg.NewNotificationOfRegisteringLotteryOrder(lotteryOrder)
-       if err != nil {
-               return "", errors.New("failed to create notification")
-       }
-
-       // ãã®é€šçŸ¥ã‚’æ°¸ç¶šåŒ–ã€‚é€šçŸ¥ã‚‚é£›ã°ã—ã¦ãã‚Œã‚‹ã¨ã™ã‚‹
-       err = u.notificationRepo.Save(notif)
-       if err != nil {
-               return "", errors.New("failed to save notification")
-       }
-
        return lotteryOrder.LotteryOrderID, nil
 }
```

diffã®ä¸­ã«æ—§å®Ÿè£…ã®å‰Šé™¤ã¨ã€æ–°å®Ÿè£…ã®è¿½åŠ ãŒæ··åœ¨ã—ã¦ã„ã¾ã™ã€‚[^1]

## ãƒ—ãƒ«ãƒªã‚¯ã‚’åˆ†ã‘ã‚‹ã‚„ã‚Šæ–¹

æ–°å®Ÿè£…ã®æ–¹ã‚’ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

```go
package usecase

import (
	"errors"
	"example.com/go-mod-test/flag/pkg"
)

const registersLotteryWithHoge = false

type HogeClient struct{}

func (c *HogeClient) postLotteries(_ string) (string, error) {
	// emailã‚’ä½¿ã£ã¦ã€Hogeç¤¾ã®å®ãã˜ã®æ³¨æ–‡ã™ã‚‹APIã‚’å©ã„ã¦ã€Hogeç¤¾ç®¡ç†ã®å®ãã˜IDãŒè¿”ã£ã¦ãã‚‹ã¨ã—ã¾ã—ã‚‡ã†
	return "12345", nil
}

type RegisterLotteryOrderUsecase struct {
	hoge             *HogeClient
	userRepo         *pkg.UserRepository
	lotteryOrderRepo *pkg.LotteryOrderRepository
	notificationRepo *pkg.NotificationRepository
}

func (u *RegisterLotteryOrderUsecase) exec(uid string) (lotteryOrderID string, err error) {
	id, err := pkg.GenerateID()
	if err != nil {
		return "", err
	}

	if registersLotteryWithHoge {
		// Emailã‚’å‡ºã™ãŸã‚ã«è©²å½“ãƒ¦ãƒ¼ã‚¶ã‚’æŠ½å‡º
		user := u.userRepo.FindByUID(uid)

		// Hogeç¤¾ã«APIã§é€£æºã€‚ã“ã®ã¨ãã«é€šçŸ¥ã‚‚é£›ã¶
		hogeLotteryOrderID, err := u.hoge.postLotteries(user.Email)

		// å†…éƒ¨ã§ç®¡ç†ã™ã‚‹ãŸã‚ã€å®ãã˜ã®æ³¨æ–‡ã‚’ä½œæˆ
		lotteryOrder, err := pkg.NewLotteryOrder(id, uid, "hoge", hogeLotteryOrderID)
		if err != nil {
			return "", errors.New("failed to create new lottery order")
		}

		// ãã®æ³¨æ–‡ã‚’æ°¸ç¶šåŒ–
		err = u.lotteryOrderRepo.Save(lotteryOrder)
		if err != nil {
			return "", errors.New("failed to save lottery order")
		}

		return lotteryOrder.LotteryOrderID, nil
	}

	// å®ãã˜ã®æ³¨æ–‡ã‚’ä½œæˆ
	lotteryOrder, err := pkg.NewLotteryOrder(id, uid, "", "")
	if err != nil {
		return "", errors.New("failed to create new lottery order")
	}

	// ãã®æ³¨æ–‡ã‚’æ°¸ç¶šåŒ–
	err = u.lotteryOrderRepo.Save(lotteryOrder)
	if err != nil {
		return "", errors.New("failed to save lottery order")
	}

	// å®ãã˜ã®æ³¨æ–‡ã®é€šçŸ¥ã‚’ä½œæˆ
	notif, err := pkg.NewNotificationOfRegisteringLotteryOrder(lotteryOrder)
	if err != nil {
		return "", errors.New("failed to create notification")
	}

	// ãã®é€šçŸ¥ã‚’æ°¸ç¶šåŒ–ã€‚é€šçŸ¥ã‚‚é£›ã°ã—ã¦ãã‚Œã‚‹ã¨ã™ã‚‹
	err = u.notificationRepo.Save(notif)
	if err != nil {
		return "", errors.New("failed to save notification")
	}

	return lotteryOrder.LotteryOrderID, nil
}
```

ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã§ã™ã€‚

- `registersLotteryWithHoge`ã¨ã„ã†ã€ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ©ã‚°ã‚’è¨­ã‘ã‚‹ã€‚ã“ã‚Œã‚’åˆ‡ã‚Šæ›¿ãˆã‚Œã°æ–°å®Ÿè£…ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚‹ã€‚æ©Ÿèƒ½é–‹ç™ºæ™‚ã«ã¯æ—§å®Ÿè£…ã®æ–¹ã«å‡¦ç†ãŒé€²ã‚€ã‚ˆã†ã«ã™ã‚‹ã€‚
- æ–°å®Ÿè£…ã¯è¿½åŠ è¡Œã ã‘ã§è¡¨ç¾ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
- æ—§å®Ÿè£…ã¯ã¾ã‚‹ã”ã¨æ®‹ã™(å‰Šé™¤ã—ãªã„)ã€‚

ã“ã†ã™ã‚‹ã“ã¨ã§ã€diffã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚

```diff go
 package usecase
 
 import (
        "errors"
        "example.com/go-mod-test/flag/pkg"
 )
 
+const registersLotteryWithHoge = false
+
+type HogeClient struct{}
+
+func (c *HogeClient) postLotteries(_ string) (string, error) {
+       // emailã‚’ä½¿ã£ã¦ã€Hogeç¤¾ã®å®ãã˜ã®æ³¨æ–‡ã™ã‚‹APIã‚’å©ã„ã¦ã€Hogeç¤¾ç®¡ç†ã®å®ãã˜IDãŒè¿”ã£ã¦ãã‚‹ã¨ã—ã¾ã—ã‚‡ã†
+       return "12345", nil
+}
+
 type RegisterLotteryOrderUsecase struct {
+       hoge             *HogeClient
+       userRepo         *pkg.UserRepository
        lotteryOrderRepo *pkg.LotteryOrderRepository
        notificationRepo *pkg.NotificationRepository
 }
 
 func (u *RegisterLotteryOrderUsecase) exec(uid string) (lotteryOrderID string, err error) {
        id, err := pkg.GenerateID()
        if err != nil {
                return "", err
        }
 
+       if registersLotteryWithHoge {
+               // Emailã‚’å‡ºã™ãŸã‚ã«è©²å½“ãƒ¦ãƒ¼ã‚¶ã‚’æŠ½å‡º
+               user := u.userRepo.FindByUID(uid)
+
+               // Hogeç¤¾ã«APIã§é€£æºã€‚ã“ã®ã¨ãã«é€šçŸ¥ã‚‚é£›ã¶
+               hogeLotteryOrderID, err := u.hoge.postLotteries(user.Email)
+
+               // å†…éƒ¨ã§ç®¡ç†ã™ã‚‹ãŸã‚ã€å®ãã˜ã®æ³¨æ–‡ã‚’ä½œæˆ
+               lotteryOrder, err := pkg.NewLotteryOrder(id, uid, "hoge", hogeLotteryOrderID)
+               if err != nil {
+                       return "", errors.New("failed to create new lottery order")
+               }
+
+               // ãã®æ³¨æ–‡ã‚’æ°¸ç¶šåŒ–
+               err = u.lotteryOrderRepo.Save(lotteryOrder)
+               if err != nil {
+                       return "", errors.New("failed to save lottery order")
+               }
+
+               return lotteryOrder.LotteryOrderID, nil
+       }
+
        // å®ãã˜ã®æ³¨æ–‡ã‚’ä½œæˆ
        lotteryOrder, err := pkg.NewLotteryOrder(id, uid, "", "")
        if err != nil {
                return "", errors.New("failed to create new lottery order")
        }
 
        // ãã®æ³¨æ–‡ã‚’æ°¸ç¶šåŒ–
        err = u.lotteryOrderRepo.Save(lotteryOrder)
        if err != nil {
                return "", errors.New("failed to save lottery order")
        }
 
        // å®ãã˜ã®æ³¨æ–‡ã®é€šçŸ¥ã‚’ä½œæˆ
        notif, err := pkg.NewNotificationOfRegisteringLotteryOrder(lotteryOrder)
        if err != nil {
                return "", errors.New("failed to create notification")
        }
 
        // ãã®é€šçŸ¥ã‚’æ°¸ç¶šåŒ–ã€‚é€šçŸ¥ã‚‚é£›ã°ã—ã¦ãã‚Œã‚‹ã¨ã™ã‚‹
        err = u.notificationRepo.Save(notif)
        if err != nil {
                return "", errors.New("failed to save notification")
        }
 
        return lotteryOrder.LotteryOrderID, nil
 }
```

æ–°å®Ÿè£…ã‚’è¿½åŠ è¡Œã ã‘ã§è¡¨ç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã“ã‚Œã¯ãƒ¬ãƒ“ãƒ¥ã‚¢ç›®ç·šã ã¨ä»¥ä¸‹ã®åŠ¹æœãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

- æ—§å®Ÿè£…ãŒãã®ã¾ã¾æ®‹ã£ã¦ã„ã‚‹ã®ã§ã€æ—§å®Ÿè£…ãŒã†ã¾ãæ®‹ã£ã¦ã„ã‚‹ã‹ã®è¦³ç‚¹ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã™ã‚‹å¿…è¦ãŒç„¡ã„ã€‚
- ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ©ã‚°ã¯æ—§å®Ÿè£…ã«å‘ã„ã¦ã„ã‚‹ã®ã§ã€ã„ããªã‚Šãƒãƒ¼ã‚¸ã—ã¦å¤§ä¸ˆå¤«ã‹ã®è¦³ç‚¹ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å¿…è¦ãŒç„¡ã„ã€‚
- æ–°è¦è¿½åŠ ã—ãŸéƒ¨åˆ†ãŒæ­£ã—ã„è¨­è¨ˆã«ãªã£ã¦ã„ã‚‹ã‹ã¨ã€ä»•æ§˜ã‚’å®Ÿç¾ã§ãã¦ã„ã‚‹ã‹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚Œã°è‰¯ã„ã€‚

ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·ãŒå¤§å¹…ã«ä¸‹ãŒã‚Šã€æœ¬æ¥ã‚„ã‚ŠãŸã‹ã£ãŸè¨­è¨ˆã‚„ä»•æ§˜ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«é›†ä¸­ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚


memo:
ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã¨ãã®diff
å‰Šé™¤ã™ã‚‹ã¨ãã®diffã€è¿½åŠ è¡Œã¨ã—ã¦ã‚‚å‡ºã¦ã—ã¾ã†ãŒã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ã‚¹ãƒˆã¯ä½ã„

# å‰¯ç”£ç‰©

## åˆ‡ã‚Šæˆ»ã—ãŒå®¹æ˜“ã«ãªã‚‹

ãƒªãƒªãƒ¼ã‚¹ã¾ã§è¡Œã£ãŸå¾Œã«ã€ãƒã‚°ãŒç™ºè¦šã—ãŸã¨ã—ã¾ã™ã€‚
åˆ‡ã‚Šæˆ»ã—ã®åˆ¤æ–­ã¯ã€ãƒ—ãƒ«ãƒªã‚¯ãŒå¤§ãããªã‚‹ã¨å›°é›£ã«ãªã‚Šã‚„ã™ã„ã§ã™ã€‚
revertã™ã‚‹ã¨ã—ã¦ã‚‚ã€ãã®å¾Œã«ãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ãŸãƒãƒ¼ã‚¸ã—ãŸå®Ÿè£…ãªã©ãŒã‚ã‚‹ã¨ã€ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’è§£æ±ºã™ã‚‹ã®ã‚‚ä¸€è‹¦åŠ´ã§ã™ã€‚

ä¸€æ–¹ã€æœ¬è¨˜äº‹ã§è§£èª¬ã—ãŸã‚„ã‚Šæ–¹ã§ã‚ã‚Œã°ã€æ©Ÿèƒ½è¿½åŠ ã¨ãƒªãƒªãƒ¼ã‚¹ã‚’åˆ†ã‘ã¦ã„ã¾ã™ã€‚ 
åŸºæœ¬çš„ã«ã¯**ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ©ã‚°ã‚’åˆ‡ã‚Šæ›¿ãˆã‚Œã°è‰¯ã„ã ã‘**ã«ãªã‚Šã€åˆ‡ã‚Šæˆ»ã—ãŒæ˜ç¤ºçš„ã§ã™ã€‚
ã‚‚ã¡ã‚ã‚“ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã®å•é¡Œã¯æ®‹ã‚‹ã‚‚ã®ã®ã€æ¯”è¼ƒçš„åˆ‡ã‚Šæˆ»ã—åˆ¤æ–­ãƒ»ä½œæ¥­ãŒç°¡å˜ã«ã§ãã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

## æ—§å®Ÿè£…ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ®‹ã™ã“ã¨ãŒã§ãã‚‹

## ãƒªãƒªãƒ¼ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ä¾å­˜ã«ã•ã›ãªã„ã“ã¨ãŒã§ãã‚‹


## æœ¬ç•ªç’°å¢ƒã§ã¯æ—§ä»•æ§˜ãŒå‹•ãã€æ¤œè¨¼ç’°å¢ƒã§ã¯æ–°ä»•æ§˜ã‚’ãƒ‡ãƒãƒƒã‚°ã•ã›ã‚‹ã¨ã„ã†åˆ‡ã‚Šæ›¿ãˆãŒã§ãã‚‹


[^1]: ã¶ã£ã¡ã‚ƒã‘ã“ã®ãã‚‰ã„ã®å¤‰æ›´è¡Œãªã‚‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã€ã¨ã„ã†ãƒ„ãƒƒã‚³ãƒŸã¯ç„¡ã—ã§ã€‚ã‚ãã¾ã§ä¾‹ã§ã™ã€‚